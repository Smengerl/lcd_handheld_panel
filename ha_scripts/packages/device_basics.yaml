substitutions:
  #  display_id: my_display
  touchscreen_id: my_touchscreen

esp32:
  board: esp32-s3-devkitc-1
  variant: esp32s3
  flash_size: 16MB
  framework:
    type: esp-idf
    sdkconfig_options:
      COMPILER_OPTIMIZATION_SIZE: y
      CONFIG_ESP32S3_DEFAULT_CPU_FREQ_240: y
      CONFIG_ESP32S3_DATA_CACHE_64KB: y
      CONFIG_ESP32S3_DATA_CACHE_LINE_64B: y
      CONFIG_SPIRAM_FETCH_INSTRUCTIONS: y
      CONFIG_SPIRAM_RODATA: y

# Option to enable PSRAM, see https://esphome.io/components/psram.html
# Only available on ESP32
psram:
  mode: octal
  speed: 80MHz

logger:
  level: info
  logs:
    i2c.idf: info
    touchscreen: info
    scheduler: none

# Enable Home Assistant API
api:
  encryption:
    key: ${api_key}

ota:
  - platform: esphome
    password: ${ota_pw}

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: ${fallback_hotspot_ssid}
    password: ${fallback_hotspot_pw}

captive_portal:

# Displays a notification in case the device need to be updated
dashboard_import:
  package_import_url: github://esphome/example-configs/esphome-web/esp32.yaml@main
  import_full_config: true

web_server:
  port: 80
  version: 3

time:
  - platform: sntp
    id: clock_timer
    timezone: Europe/Amsterdam
    servers:
      - 0.pool.ntp.org
      - 1.pool.ntp.org
      - 2.pool.ntp.org

#-------------------------------------------
# Internal outputs
# (definiert die physikalisch tatsächlich vorhandenen Aktoren des ESPs, die darüber hier
# intern verfügbar werden aber nicht auch schon in HA exponiert sind)
#-------------------------------------------
output:
  # Backlight LED
  - platform: ledc
    pin: GPIO38
    id: GPIO38
    frequency: 100Hz

  # Built in 240v relay
  - id: panel_output
    platform: gpio
    pin: 40

#-------------------------------------------
# Internal lights
# (definiert die vom ESP in HA zu exponierenden Aktoren)
#-------------------------------------------
light:
  ## Expose display backlight
  - platform: monochromatic
    output: GPIO38
    name: Backlight
    id: backlight
    restore_mode: ALWAYS_ON

  ## Expose internal relay as light
  - platform: binary
    name: "Panel Switch"
    id: panel_switch
    output: panel_output

#-------------------------------------------
# Touchscreen gt911 i2c
#-------------------------------------------
i2c:
  - id: bus_a
    sda: GPIO19
    # WARNING: GPIO45 is a strapping pin on many ESP32-S3 boards and
    # should only be used for I/O with care. Attaching external pull-up
    # or pull-down resistors to strapping pins can cause unexpected
    # boot failures. If possible choose a different SCL pin. See:
    # https://esphome.io/guides/faq.html#why-am-i-getting-a-warning-about-strapping-pins
    scl:
      number: GPIO45
      ignore_strapping_warning: true
    #frequency: 100kHz

touchscreen:
  platform: gt911
  transform:
    mirror_x: false
    mirror_y: false
  id: $touchscreen_id
  #display: $display_id
  on_touch:
    - logger.log:
        format: Touch at (%d, %d)
        args: [touch.x, touch.y]
    - lambda: |-
        ESP_LOGI("${TAG}", "x=%d, y=%d, x_raw=%d, y_raw=%0d",
            touch.x,
            touch.y,
            touch.x_raw,
            touch.y_raw
            );

#-------------------------------------------
# Display st7701s spi
#-------------------------------------------
spi:
  - id: lcd_spi
    clk_pin: GPIO48
    mosi_pin: GPIO47

display:
  - platform: st7701s
    #    id: $display_id
    update_interval: never
    auto_clear_enabled: False
    spi_mode: MODE3
    data_rate: 2MHz
    color_order: RGB
    invert_colors: False
    dimensions:
      width: 480
      height: 480
    cs_pin: 39
    de_pin: 18
    hsync_pin: 16
    vsync_pin: 17
    pclk_pin: 21
    pclk_frequency: 12MHz
    pclk_inverted: False
    hsync_pulse_width: 8
    hsync_front_porch: 10
    hsync_back_porch: 20
    vsync_pulse_width: 8
    vsync_front_porch: 10
    vsync_back_porch: 10
    init_sequence:
      - 1
      # Custom sequences are an array, first byte is command, the rest are data.
      - [0xFF, 0x77, 0x01, 0x00, 0x00, 0x10] # CMD2_BKSEL_BK0
      - [0xCD, 0x00] # disable MDT flag
    data_pins:
      red:
        - 11 #r1
        - 12 #r2
        - 13 #r3
        - 14 #r4
        - 0 #r5
      green:
        - 8 #g0
        - 20 #g1
        - 3 #g2
        - 46 #g3
        - 9 #g4
        - 10 #g5
      blue:
        - 4 #b1
        - 5 #b2
        - 6 #b3
        - 7 #b4
        - 15 #b5

#-------------------------------------------
# LVGL Basic config
#-------------------------------------------
lvgl:
  #  displays:
  #    - display_id: $display_id
  touchscreens:
    - touchscreen_id: $touchscreen_id
